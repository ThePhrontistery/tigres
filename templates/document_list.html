{% extends "base.html" %}
{% block content %}
<div id="document-list-panel">
  {% if deleted_message %}
    <div class="p-2 mb-2 bg-green-100 text-green-800 rounded text-center animate-fade-in">{{ deleted_message }}</div>
  {% endif %}
  {% if message %}
    <div id="modal-success" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50">
      <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-xs text-center animate-fade-in">
        <div class="text-green-700 text-lg font-semibold mb-2">{{ message }}</div>
        <button class="mt-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" onclick="document.getElementById('modal-success').remove()">Cerrar</button>
      </div>
    </div>
  {% endif %}
  <ul id="documents-list" class="mb-4">
    {% if documents and documents|length > 0 %}
      {% for doc in documents %}
        <li class="flex items-center justify-between text-blue-800 border-b py-1">
          <span>{{ doc.file_name }}</span>
          <div class="flex gap-2">
            <button 
              class="text-xs bg-blue-100 hover:bg-blue-200 text-blue-800 px-2 py-1 rounded"
              hx-get="/documents/view?file_name={{ doc.file_name }}"
              hx-target="#document-detail-modal"
              hx-swap="innerHTML">
              Ver
            </button>
            <button 
              class="text-xs bg-red-100 hover:bg-red-200 text-red-700 px-2 py-1 rounded"
              hx-delete="/api/documents/delete?file_name={{ doc.file_name }}"
              hx-target="#document-list-panel"
              hx-swap="outerHTML"
              hx-confirm="Â¿Seguro que deseas eliminar este documento?"
              hx-vals='{"show_message": true}'>
              Eliminar
            </button>
            <a 
              class="text-xs bg-green-100 hover:bg-green-200 text-green-800 px-2 py-1 rounded"
              href="/api/documents/download?file_name={{ doc.file_name }}"
              target="_blank"
              download>
              Descargar
            </a>
          </div>
        </li>
      {% endfor %}
    {% else %}
      <li class="text-gray-400">No hay documentos subidos.</li>
    {% endif %}
  </ul>
  <div class="flex gap-2 mt-2">
    <button 
      class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
      hx-get="/documents/upload-modal" 
      hx-target="#modal-container" 
      hx-swap="innerHTML">
      Subir documentos
    </button>
    <button 
      class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
      id="generar-funcional-btn"
      type="button"
      title="Generar documento funcional a partir de los documentos subidos">
      Generar Funcional
    </button>
  </div>
</div>
<div id="modal-container"></div>
<div id="document-detail-modal"></div>
<style>
@keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
.animate-fade-in { animation: fade-in 0.2s; }
</style>
{% endblock %}
