{% extends 'base.html' %} {% block content %}
<div
  class="max-w-xl mx-auto mt-4 p-4 bg-white rounded shadow overflow-x-auto overflow-y-auto"
  style="min-height: 200px; max-height: 430px"
>
  <ul class="pl-4 border-l-2 border-gray-300 min-w-[350px]">
    {% for node in tree %}
    <li class="mb-2">
      <a
        href="#"
        class="font-semibold text-blue-700 hover:underline"
        data-section-id="{{ node.num }}. {{ node.title }}"
        onclick="goToSection(event, '{{ node.num }}. {{ node.title }}')"
        >{{ node.num }}. {{ node.title }}</a
      >
      {% if node.children %}
      <ul class="pl-4 list-disc">
        {% for child in node.children %}
        <li>
          <a
            href="#"
            class="text-blue-600 hover:underline"
            data-section-id="{{ child.num }} {{ child.title }}"
            onclick="goToSection(event, '{{ child.num }} {{ child.title }}')"
            >{{ child.num }} {{ child.title }}</a
          >
        </li>
        {% endfor %}
      </ul>
      {% endif %}
    </li>
    {% endfor %}
  </ul>
</div>
<script>
  function goToSection(e, sectionTitle) {
    e.preventDefault();
    // Busca el textarea y mueve el cursor al inicio de la sección
    const textarea =
      window.parent.document.getElementById("markdown-input") ||
      document.getElementById("markdown-input");
    if (!textarea) return;
    const value = textarea.value;
    // Busca el título como encabezado Markdown (## o ###)
    const regex = new RegExp(
      `^#+\\s*${sectionTitle.replace(/[.*+?^${}()|[\]\\]/g, "\\$&")}`,
      "m"
    );
    const match = value.match(regex);
    if (match) {
      const pos = match.index;
      textarea.focus();
      textarea.setSelectionRange(pos, pos);
      // Scroll automático
      textarea.scrollTop = textarea.scrollHeight * (pos / value.length);
    }
  }
</script>
{% endblock %}
